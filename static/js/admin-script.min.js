var ParseUrl=function(){function e(e){this.url=e,this.parse()}var t=e.prototype;return t.parse=function(){var e,t,n=document.createElement("a"),r={},i=[];for(n.href=this.url,i=n.search.replace(/^\?/,"").split("&"),t=0;t<i.length;t++)""!==(e=i[t].split("="))[0]&&null!==e[0]?r[e[0]]=e[1]:null===e[1]&&(r[e[0]]=!0);this.protocol=n.protocol,this.host=n.host,this.hostname=n.hostname,this.port=n.port,this.pathname=n.pathname,this.search=n.search,this.searchObject=r,this.hash=n.hash},t.queryString=function(){var t=this;return Object.keys(this.searchObject).map(function(e){return escape(e)+"="+escape(t.searchObject[e])}).join("&")},t.buildUrl=function(){var e=this.queryString();return this.protocol+"//"+this.host+this.pathname+"?"+e},e}(),addAudienceOption=function(){var e=null;if(!e){var t=window.wpActiveEditor;if(!t)return;if(void 0===window.tinymce)return;e=window.tinymce.get(t)}var r=wpLink.getAttrs,n=e?e.$('a[data-wplink-edit="true"]'):null,i=$("#link-options");$("#wpse-link-audience").length<1&&UCF_AUDIENCE&&i.append(UCF_AUDIENCE.wpse_link_audience);var a=n.attr("data-set-audience");if(a&&a.length){var s=a.split(","),o=Array.isArray(s),c=0;for(s=o?s:s[Symbol.iterator]();;){var h;if(o){if(c>=s.length)break;h=s[c++]}else{if((c=s.next()).done)break;h=c.value}var l=h;i.find("option[value="+l+"]").attr("selected",!0)}}wpLink.getAttrs=function(){var e=r(),t=$("#wpse-link-audience").val(),n=new ParseUrl(e.href);return t&&(n.searchObject.audience=t,e.href=n.buildUrl(),e["data-set-audience"]=$("#wpse-link-audience").val()),e}};jQuery(document).on("wplink-open",function(){addAudienceOption()});